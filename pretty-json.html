<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="bower_components/polymer/polymer.html">

<dom-module id="pretty-json">
  <template>
    <style>
      ::host {
        display: block;
        border: 1px solid red;
      }
      
      #output {
        background: #212121;
        color: #89ddff;
        outline: 1px solid #ccc; 
        padding: 5px; 
        margin: 5px; 
      }

      ::selection {
        background: #c8c8c8; /* WebKit/Blink Browsers */
      }

      ::-moz-selection {
        background: #c8c8c8; /* Gecko Browsers */
      }

      .key { color: #82aaff; }
      .string { color: #c3e176; }
      .number { color: #f78c6c; }
      .boolean { color: #f78c6c; }
      .null { color: #f78c6c; }
    </style>
    <pre id="output">{{ output }}</pre>
  </template>

  <script>
    Polymer({
      is: 'pretty-json',
      properties: {
        output: {
          type: String,
          observer: '_htmlChanged',
          value: function() {
            return {
              key: 'value',
              'array': [
                'item1', 'item2'
              ]
            }
          }
        }
      },

      _htmlChanged: function(value) {
        var stringified = JSON.stringify(value, undefined, 2);
        var syntaxed = this.syntaxHighlight(stringified);
        Polymer.dom(this.$.output).innerHTML = syntaxed;
      },

      syntaxHighlight: function(json) {
        json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
            var cls = 'number';
            if (/^"/.test(match)) {
                if (/:$/.test(match)) {
                    cls = 'key';
                } else {
                    cls = 'string';
                }
            } else if (/true|false/.test(match)) {
                cls = 'boolean';
            } else if (/null/.test(match)) {
                cls = 'null';
            }
            return '<span class="' + cls + '">' + match + '</span>';
        });
      }
    });
  </script>
</dom-module>
